<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Facture Live PDF Preview</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
</head>
<body>
<div class="container-fluid my-4">
  <div class="row">
    <!-- Form -->
    <div class="col-md-5">
      <h4>Facture Formulaire</h4>
      <form id="invoiceForm">
        <div class="mb-3">
          <label for="client" class="form-label">Client</label>
          <input type="text" class="form-control" id="client" value="EVIOSYS EMBALAJES ESPANA S.A.U">
        </div>
        <div class="mb-3">
          <label for="invoiceNumber" class="form-label">Numéro Facture</label>
          <input type="text" class="form-control" id="invoiceNumber" value="202501-55">
        </div>
        <div class="mb-3">
          <label for="invoiceDate" class="form-label">Date Facture</label>
          <input type="date" class="form-control" id="invoiceDate" value="2025-01-31">
        </div>
        <div class="mb-3">
          <label for="item" class="form-label">Désignation</label>
          <input type="text" class="form-control" id="item" value="TRANSPORT">
        </div>
        <div class="mb-3">
          <label for="quantity" class="form-label">Quantité</label>
          <input type="number" class="form-control" id="quantity" value="1">
        </div>
        <div class="mb-3">
          <label for="unitPrice" class="form-label">Prix Unitaire HT</label>
          <input type="number" class="form-control" id="unitPrice" value="1250">
        </div>
      </form>
    </div>

    <!-- PDF Preview -->
    <div class="col-md-7">
      <h4>PDF Aperçu</h4>
      <iframe id="pdfPreview" style="width:100%; height:800px;"></iframe>
    </div>
  </div>
</div>

<script>
const formElements = ['client','invoiceNumber','invoiceDate','item','quantity','unitPrice'];

function generatePdf() {
    const client = document.getElementById('client').value;
    const invoiceNumber = document.getElementById('invoiceNumber').value;
    const invoiceDate = document.getElementById('invoiceDate').value;
    const item = document.getElementById('item').value;
    const quantity = parseFloat(document.getElementById('quantity').value);
    const unitPrice = parseFloat(document.getElementById('unitPrice').value);
    const total = quantity * unitPrice;

    const docDefinition = {
        pageSize: 'A4',
        pageMargins: [40, 60, 40, 60],
        content: [
            { text: 'FACTURE', style: 'header', alignment: 'center' },
            { text: `Client: ${client}`, margin:[0,10,0,0] },
            { text: `Numéro Facture: ${invoiceNumber}` },
            { text: `Date Facture: ${invoiceDate}`, margin:[0,0,0,10] },
            {
                table: {
                    widths: ['*', 'auto', 'auto', 'auto'],
                    body: [
                        ['Désignation','Qté','Prix Uni. HT','Total HT'],
                        [item, quantity.toString(), unitPrice.toFixed(2), total.toFixed(2)]
                    ]
                }
            },
            { text: `Montant Total: ${total.toFixed(2)} MAD`, margin:[0,10,0,0], bold:true }
        ],
        styles: {
            header: { fontSize: 18, bold: true }
        }
    };

    pdfMake.createPdf(docDefinition).getDataUrl(function(dataUrl) {
        document.getElementById('pdfPreview').src = dataUrl;
    });
}

// Add event listeners to update PDF on input change
formElements.forEach(id => {
    document.getElementById(id).addEventListener('input', generatePdf);
});

// Generate PDF on load
generatePdf();
</script>
</body>
</html>
